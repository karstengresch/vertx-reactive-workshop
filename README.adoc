= SCENARIO

image:images/design.png["VertX Application",height=356] 

== The Micro-Homeplan Application

This is a short description of the scenario we will be working throughout the labs

Itâ€™s going to be a fake home appliance IOT management app, where we will be able to regulate the temperature in different rooms at our home. The application is composed of a set of microservices:

* The *_homeplan_* - this is a service which allows home owners to register and review their homeplan providing the temperature in each of the rooms in their house and the heat regulating applicances in each room. 

* The *_device management_* - this is a component which receives registration and update requests on the devices.

*  The *_sensor generator_* - this is a ficticious service emitting every 20 secs an event indicating the room temperature dependent on the state of the heating device (ON/OFF and INCREASING/DECREASING temperature)

* The *_homeplan regulator_* - this is a service which reads our current homeplan and based on the emmitted temperature in the room it regulates the action a device has to take to enforece the plan ie. INCREASE, DECREASE temperature of TURNOFF the device.

= LAB 2

TIME ESTIMATION 30 MINUTES
FOLLOWED by 15 MINUTES reviewing the solution

== Concepts visited in this LAB

- http://vertx.io/docs/vertx-core/java/#event_bus[The EventBus]
- Clustering and http://vertx.io/docs/vertx-core/java/#_using_shared_data_with_vert_x[Shared Data on Vert.x]
- 

== Organizers

* Provide solution from - LAB-1 in branch LAB-1 
* Pre-Requisites: and cluster it (infinispan) --> PROVIDE as part of the INITIAL version of LAB 1 Solution


== PARTICIPANTS

==== STEP 1 - Start a clusttered Vert.x application
* clone/unzip https://github.com/skoussou/vertx-reactive-workshop Branch *LAB 2*
* Run the following command to initiate a clustered Vert.X application and you should see the relevant message to indicate clustering has taken place

Maven Command To Run VertX outside OCP
----
open new terminal
cd [REPOSITORY CLONED DIR - Branch LAB-2]*/homeplan*
mvn comiple vertx:run -Dvertx.runArgs="-cluster -Djava.net.preferIPv4Stack=true"

open new terminal
cd [REPOSITORY CLONED DIR - Branch LAB-2]*/device-management*
mvn comiple vertx:run -Dvertx.runArgs="-cluster -Djava.net.preferIPv4Stack=true"

* Read on Vert.x clustering and note we have used http://vertx.io/docs/vertx-hazelcast/java/[Hazlecast clustering configuration] therefore check the pom.xml and resources/cluster-config.xml
----

==== STEP 2 - Create content for the following parts of the scenario
* Create Content for verticles in _*homeplan*_ maven project to complete the service
  ** Using resources at http://vertx.io/docs/vertx-core/java/#event_bus[Vert.x EventBus] Fix method *_sendDevicesRegistration(FullHomePlanDTO fullHomePlanDto)_* to *_send_* Messages to #device-reg on the bus
    *** Test by executing the following request and check the console of the device-management Verticle for output showing *_FIXME - REGISTRATION HAS NOT TAKEN PLACE_*

----
open new terminal
cd [REPOSITORY CLONED DIR - Branch LAB-2]*/homeplan*
mvn compile vertx:run  -Dvertx.runArgs="-cluster -Djava.net.preferIPv4Stack=true"

open new terminal
cd [REPOSITORY CLONED DIR - Branch LAB-2]*/device-management*
mvn compile vertx:run  -Dvertx.runArgs="-cluster -Djava.net.preferIPv4Stack=true"

curl -H "Content-Type: application/json" -X POST -d '@kousourisA.json'  http://127.0.0.1:8080/homeplan/KousourisHomePlan

kousourisA.json CONTENTS
{ "KousourisHomePlan" : [{ "sensorLocations" : ["kitchen", "kitchen-1", "22"], "devices" : ["AIRCON", "kitchen-1"]}, { "sensorLocations" : ["bedroom", "bedroom-1", "23"], "devices" : ["AIRCON", "bedroom-1"]}]}


* Create Content for verticles in *_device-management_* maven project to complete the service
  ** Using resources at http://vertx.io/docs/vertx-core/java/#event_bus[Vert.x EventBus] Fix method *_registerDevices_* to *_consume_* Messages from #device-reg EventBus address and complete register Device action
    *** Test by executing the following request and check the console of the device-management Verticle for output *_Handler for adding Device ["DEVICE CONTENT"] is missing. You need to complete it_*

----
open new terminal
cd [REPOSITORY CLONED DIR - Branch LAB-2]*/homeplan*
mvn compile vertx:run  -Dvertx.runArgs="-cluster -Djava.net.preferIPv4Stack=true"

open new terminal
cd [REPOSITORY CLONED DIR - Branch LAB-2]*/device-management*
mvn compile vertx:run  -Dvertx.runArgs="-cluster -Djava.net.preferIPv4Stack=true"

curl -H "Content-Type: application/json" -X POST -d '@kousourisA.json'  http://127.0.0.1:8080/homeplan/KousourisHomePlan

kousourisA.json CONTENTS
{ "KousourisHomePlan" : [{ "sensorLocations" : ["kitchen", "kitchen-1", "22"], "devices" : ["AIRCON", "kitchen-1"]}, { "sensorLocations" : ["bedroom", "bedroom-1", "23"], "devices" : ["AIRCON", "bedroom-1"]}]}
----

  ** Using resources at ttp://vertx.io/docs/vertx-core/java/#_using_shared_data_with_vert_x[Shared Data on Vert.x] Fix method *_registerDevice_* and PUT the devices into a shared-map
    ** Use the above test and now each device should be showing as registered in the logs






= LAB 3

= LAB 4

= LAB 5

